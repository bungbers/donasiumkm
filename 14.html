<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Donasi UMKM</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f9fafb; margin: 0; padding: 0; }
    header { background: #2563eb; color: white; text-align: center; padding: 1rem; }
    main { max-width: 900px; margin: auto; padding: 1rem; }
    .project-card { background: white; border-radius: 10px; padding: 1rem; margin-bottom: 1rem; box-shadow: 0 0 8px rgba(0,0,0,0.1); }
    .project-card img { max-width: 100%; border-radius: 8px; }
    .progress { background: #e2e8f0; border-radius: 5px; overflow: hidden; height: 12px; margin-top: 8px; }
    .progress-bar { background: #10b981; height: 100%; text-align: center; color: white; font-size: 10px; }
    form { background: white; padding: 1rem; border-radius: 8px; box-shadow: 0 0 8px rgba(0,0,0,0.1); margin-top: 1rem; display: flex; flex-direction: column; gap: .5rem; }
    input, select, button { padding: .5rem; font-size: 1rem; border: 1px solid #cbd5e1; border-radius: 6px; }
    button { background: #2563eb; color: white; cursor: pointer; }
    button:hover { background: #1e40af; }
    .donor-thumb { width: 60px; height: 60px; object-fit: cover; border-radius: 6px; margin-top: 4px; cursor: pointer; }
  </style>
</head>
<body>
  <header>
    <h1>Donasi untuk Membangun UMKM</h1>
  </header>
  <main>
    <section id="project-list"></section>

    <form id="donation-form">
      <h2>Form Donasi</h2>
      <input type="text" id="donorName" placeholder="Nama Donatur" required>
      <input type="number" id="donationAmount" placeholder="Jumlah Donasi (Rp)" min="1000" required>
      <select id="projectSelect" required></select>
      <label>Upload Bukti Transfer:</label>
      <input type="file" id="donationProof" accept="image/*" required>
      <button type="submit">Kirim Donasi</button>
    </form>
  </main>

  <script>
    const PROJECTS = [
      {id: 'p1', title: 'UMKM Kerajinan Bambu', target: 5000000, raised: 0, image: 'https://source.unsplash.com/400x200/?bamboo', desc: 'Bantuan modal untuk UMKM pengrajin bambu.'},
      {id: 'p2', title: 'UMKM Kuliner Nusantara', target: 8000000, raised: 0, image: 'https://source.unsplash.com/400x200/?culinary', desc: 'Bantuan peralatan dan pelatihan untuk UMKM kuliner.'}
    ];
    const DONORS = JSON.parse(localStorage.getItem('donors') || '[]');

    function saveDonors(){ localStorage.setItem('donors', JSON.stringify(DONORS)); }
    function formatRp(num){ return 'Rp ' + num.toLocaleString('id-ID'); }

    function renderProjects(){
      const container = document.getElementById('project-list');
      const select = document.getElementById('projectSelect');
      container.innerHTML = '';
      select.innerHTML = '<option value="">Pilih Project</option>';
      PROJECTS.forEach(p => {
        const totalRaised = DONORS.filter(d=>d.projectId===p.id).reduce((sum,d)=>sum+d.amount,0);
        p.raised = totalRaised;
        const percent = Math.min(100, (p.raised/p.target)*100);

        let donorThumbs = DONORS.filter(d=>d.projectId===p.id && d.proofPath).map(d=>
          `<img src=\"${d.proofPath}\" class=\"donor-thumb\" onclick=\"window.open('${d.proofPath}','_blank')\" title=\"${d.name}\">`
        ).join('');

        container.innerHTML += `
          <div class="project-card">
            <img src="${p.image}" alt="${p.title}">
            <h3>${p.title}</h3>
            <p>${p.desc}</p>
            <div class="progress"><div class="progress-bar" style="width:${percent}%">${percent.toFixed(0)}%</div></div>
            <p>Terkumpul: ${formatRp(p.raised)} / ${formatRp(p.target)}</p>
            <div>Donatur:</div>
            <div>${donorThumbs || '<small>Belum ada donatur</small>'}</div>
          </div>
        `;
        select.innerHTML += `<option value="${p.id}">${p.title}</option>`;
      });
    }

    document.getElementById('donation-form').addEventListener('submit', e => {
      e.preventDefault();
      const name = document.getElementById('donorName').value.trim();
      const amount = Number(document.getElementById('donationAmount').value);
      const projectId = document.getElementById('projectSelect').value;
      const fileInput = document.getElementById('donationProof');
      const file = fileInput.files[0];

      if(!file){ alert('Bukti transfer wajib diupload'); return; }

      // Simpan path file ke folder image
      const fileName = `donasi-${Date.now()}-${file.name}`;
      const filePath = `image/${fileName}`;

      // Data donatur hanya menyimpan path
      DONORS.push({id: Date.now(), name, amount, projectId, proofPath: filePath});
      saveDonors();
      renderProjects();
      document.getElementById('donation-form').reset();
      alert(`File ${file.name} harus ditambahkan secara manual ke folder 'image' dengan nama ${fileName} lalu di-commit ke GitHub.`);
    });

    renderProjects();
  </script>
</body>
</html>
